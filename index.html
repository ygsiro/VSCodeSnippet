<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="VSCodeのスニペットについてまとめたページです">
  <title>VSCode スニペット</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <!-- and it"s easy to individually load additional languages -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>

  <script>hljs.highlightAll();</script>
</head>

<body>
  <nav class="sidebar">
    <ul>
      <li><a href="https://github.com/ygsiro/VSCodeSnippet" title="GitHubで修正する"><img src="img/github-mark.svg"
            alt="github icon" width="24px" height="24px"></a></li>
      <li><a href="#vscode-snippet"><span class="view">TOP</span><span class="unview">VSCode スニペット</span></a></li>
      <li><a href="#create-snippet-file"><span class="view">1</span><span class="unview">スニペットファイルの作成</span></a></li>
      <li><a href="#snippet-config"><span class="view">2</span><span class="unview">スニペットファイルの構成</span></a></li>
      <li><a href="#snippet-feature"><span class="view">3</span><span class="unview">スニペットの機能</span></a></li>
    </ul>
  </nav>
  <article id="vscode-snippet">
    <h1>VSCode スニペット</h1>
    <p>スニペットとはfor文やif文など繰り返しのコードパターンを簡単に入力できるようにするテンプレートです。</p>

    <p>VSCodeではJavascript, typescript, pythonなど多くの言語用に標準でいくつかスニペットが組み込まれており、
      さらに拡張機能を入れることでもスニペットを追加することができます。
      スニペットはIntelliSenseに他の候補と混在して表示される他、コマンドパレットからスニペットの挿入コマンドを実行すると、
      現在開いているファイルの言語に登録されているスニペットの一覧が表示されます。
      設定でタブ補完を有効（<code>"editor.tabCompletion": "on"</code>）にしているとタブ補完のサポートも受ける事も可能です。<br>
      タブ補完はデフォルトでonになっています。
      スニペットのプレフィックス（トリガーテキスト）を入力し、<kbd>Tab</kbd>キーを押してスニペットを挿入します。</p>
    <figure>
      <img src="img/devlop-snippet.png" alt="スニペットの展開" width="400px" height="72px">
      <figcaption><span class="figure">図0-1</span> javascriptファイルでforスニペットを展開してみる</figcaption>
    </figure>
    <p>
      便利なスニペットですが実はユーザー定義のスニペットを作成することも可能です。ユーザー定義のスニペットを作成するにはスニペットファイルにスニペットを記載していく必要があるのですが、スニペットファイルには大きく分けて以下の３種類があります。
    </p>
    <ol>
      <li>現在のフォルダだけで使用するスニペットを記載するスニペットファイル</li>
      <li>特定の言語だけで使用するスニペットを記載するスニペットファイル</li>
      <li>全体にわたって使用したいスニペットを記載するスニペットファイル</li>
    </ol>
    <p>
      2と3に関しては現在のフォルダだけでなく全体に影響が出るので、最初は1の現在のフォルダだけで使用できるスニペットファイルで練習するのがおすすめです。
      現在のプロジェクト以外でも使えそうなスニペットが出来たら2と3に記載してもいいと思います。
    </p>
    <section id="create-snippet-file">
      <h2>1. スニペットファイルの作成</h2>
      <p>ユーザー定義のスニペットを作成するにはスニペットファイルがまずは必要です。</p>
      <p>スニペットファイルを作成するにはVSCodeの左下の歯車アイコンからユーザースニペットを選択してください。
        選択すると以下のようなダイアログが出てきます。</p>
      <figure>
        <img src="img/create-snippet-file.png" alt="スニペットファイルの作成" width="400px" height="82px">
        <figcaption><span class="figure">図1-1</span> 作成するスニペットファイルの種類を選択する</figcaption>
      </figure>
      <p>新しいグローバルスニペット ファイル...を選択した場合、全体にわたって使用したいスニペットを記述するスニペットファイルが開かれます。<br>
        "現在開いているフォルダ名"の新しいスニペットファイル...を選択した場合、現在のフォルダのみで使用するスニペットを記述するスニペットファイルが開かれます。<br>
        上記二つのスニペットファイルは作成する際にファイル名の入力を求められますが、できるだけわかりやすい名前をつけましょう。</p>
      <figure><img src="img/name-snippet-file.png" alt="ファイル名の入力" width="400px" height="42px">
        <figcaption><span class="figure">図1-2</span> ファイル名を入力。わかりやすい名前をつけよう。</figcaption>
      </figure>
      <p>
        その下に記載の言語を選択するとその言語専用のスニペットを記述するJSonファイルが開かれます。</p>
      <hr>
      <p>
        一度スニペットファイルを作成していると上段に作成済みのスニペットファイルが選択できるようになっているので、スニペットを追加したい場合は作成済みのスニペットファイルを選択しましょう。
      <figure>
        <img src="img/created-snippet-file.png" alt="作成済のスニペットファイル" width="400px" height="97px">
        <figcaption><span class="figure">図1-3</span> 作成済みのスニペットファイルは上段に表示される。</figcaption>
      </figure>
      </p>
    </section>
    <section id="snippet-config">
      <h2>2. スニペットファイルの構成</h2>
      <p>現在開いているフォルダ名のスニペットファイルを新規で作成した場合は下記のような形で英語の説明とサンプルがコメントで記載されています。</p>
      <figure>
        <pre><code class="json">{
// Place your VSCode ワークスペース snippets here. Each snippet is defined under a snippet name and has a scope, prefix, body and
// description. Add comma separated ids of the languages where the snippet is applicable in the scope field. If scope
// is left empty or omitted, the snippet gets applied to all languages. The prefix is what is
// used to trigger the snippet and the body will be expanded and inserted. Possible variables are:
// $1, $2 for tab stops, $0 for the final cursor position, and ${1:label}, ${2:another} for placeholders.
// Placeholders with the same ids are connected.
// Example:
// "Print to console": {
// "scope": "javascript,typescript",
// "prefix": "log",
// "body": [
// "console.log("$1");",
// "$2"
// ],
// "description": "Log output to console"
// }
}</code></pre>
        <figcaption><span class="figure">図2-1</span> スニペットファイルを新規作成</figcaption>
      </figure>
      <p>javascriptとtypescript用のスニペットのサンプルがコメントアウトされて記載されています。</p>
      <p><code>// "Print to console": {</code>から<code>// }</code>の行までを選択し、
        <kbd><kbd>Ctrl</kbd> + <kbd>/</kbd></kbd>(Macの場合は<kbd><kbd>Command</kbd> + <kbd>/</kbd></kbd>)でコメントを解除します。
      </p>
      <figure>
        <pre><code class="json">{
// コメントは省略
 "Print to console": {
 "scope": "javascript,typescript",
 "prefix": "log",
 "body": [
 "console.log("$1");",
 "$2"
 ],
 "description": "Log output to console"
 }
}</code></pre>
        <figcaption><span class="figure">図2-2</span> コメントアウトを解除</figcaption>
      </figure>
      <p>
        これでユーザー定義のスニペット<code>"Print to console"</code>が作成できましたが、
        <code>"prefix"</code>欄のトリガーテキスト<code>"log"</code>はJavascript,typescriptともにVSCode標準のスニペットとしてすでに登録されてるため<code>"log"</code>から<code>"user-log"</code>と書き換えましょう。
      </p>
      <figure>
        <pre><code class="json">{
// コメントは省略
 "Print to console": {
 "scope": "javascript,typescript",
 "prefix": "user-log", // "log"から"user-log"に書き換える
 "body": [
 "console.log("$1");",
 "$2"
 ],
 "description": "Log output to console"
 }
}</code></pre>
        <figcaption><span class="figure">図2-3</span> 重複するとわかりづらいので重複しないように書き換える</figcaption>
      </figure>
      <p>現在のフォルダでjavascriptファイルを作成しuser-logと入力すると展開直前に以下のように表示されます。</p>
      <figure>
        <img src="img/develop.png" alt="展開例" width="400px" height="67px">
        <figcaption><span class="figure">図2-4</span> 該当位置</figcaption>
      </figure>
      <p>トリガーテキスト<code>"user-log"</code>の横にスニペット名<code>"Print to
        console"</code>、さらにその横に<code>"description"</code>欄に記載した説明、<code>"body"</code>欄の実際に展開した時のプレビューが表示されます。</p>

      <section id="snippet-name">
        <h3>2-1. スニペット名</h3>
        <p><b>[図2-3]</b>に記載の<code>"Print to console"</code>がスニペット名となります。<br>
          トリガーテキストの横に短く表示されるのでスニペットがどんなものか短くわかりやすく書きましょう<br>
          スニペットファイルの中で一意の値になる必要があります。</p>
      </section>
      <section id="scope">
        <h3>2-2. スコープ</h3>
        <p>スニペットを使用する言語を<code>"scope"</code>欄にカンマ区切りで羅列します。
          言語専用のスニペットファイルではこの項目自体がありません。</p>
        <p>この項目はオプションなのでなくてもいいですが可能な限り記載した方がいいでしょう。</p>
      </section>
      <section id="body">
        <h3>2-3. スニペット</h3>
        <p>展開したいコードを<code>"body"</code>欄に記載します。</p>
        <p>複数行になる場合は<b>図2-3</b>のように[]で囲ってください。</p>
        <p>
          スニペットには展開した後のカーソル位置を指定できるタブストップや
          タブストップの位置にデフォルトの文字を入力しておくプレースホルダー、
          選択肢から選択できるチョイス、現在の時刻などを入力できる変数、
          正規表現などいろいろな機能があります。<br>
          機能については次の章で説明します。
        </p>
      </section>
      <section id="description">
        <h3>2-4. 説明文</h3>
        <p><code>"description"</code>欄にスニペット名で説明しきれなかったスニペットの詳細な説明を記載します。</p>
        <p>この項目はオプションです。不要な場合は記載しなくても問題ありません。</p>
      </section>
      <section id="isFileTemplate">
        <h3>2-4. ファイルテンプレート</h3>
        <p>サンプルに出てこなかった項目として<code>"isFileTemplate"</code>という項目があります。</p>
        <p>この値を<code>true</code>にした場合、スニペットがファイルテンプレートとなります。</p>
        <p>ファイルテンプレートになった場合、コマンドパレットからスニペットをファイルで満たすという項目にそのスニペットが登録されます。</p>
        <p>コマンドを実行してスニペットを挿入すると、現在のファイルの中身がスニペットの内容になります。<br>
          htmlなど雛形がある程度決まっているような場合に使うといいでしょう。</p>
        <p class="note">注意点としてすでに何かファイルに記載していた場合、記載していた内容は全て消えます。<br>
          この項目を<code>true</code>にする場合はうっかり呼び出さないように<code>"prefix"</code>欄は記載しないほうがいいでしょう。</p>
        <figure>
          <pre><code class="json">{
"HTML Template": {
  "scope": "html",
  "body": [
    "&lt;!DOCTYPE html&gt;",
    "&lt;html lang=\"${1:ja}\"&gt;",
    "&lt;head&gt;",
    "  &lt;meta charset=\"UTF-8\"&gt;",
    "  &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;",
    "  &lt;title&gt;${2:title}&lt;/title&gt;",
    "&lt;/head&gt;",
    "&lt;body&gt;",
    "$0",
    "&lt;/body&gt;",
    "&lt;/html&gt;",
  ],
  "isFileTemplate": true, // このスニペットはファイルテンプレートです
  "description": "HTMLファイルの雛形の例。"
}
}</code></pre>
          <figcaption><span class="figure">図2-5</span> HTMLの雛形のスニペットの例</figcaption>
        </figure>
      </section>
    </section>
    <section id="snippet-feature">
      <h2>3. スニペットの機能</h2>
      <p>スニペットの<code>"body"</code>欄で使用可能な機能の一覧です。</p>
      <section id="tabstop">
        <h3>3-1. タブストップ</h3>
        <p>タブストップはスニペットを展開した後に<kbd>Tab</kbd>キーで移動する位置を指定するための機能です。</p>
        <p>サンプルでも記載があった<code>$1,$2...$0</code>が該当します。</p>
        <p>文中の<code>$1</code>に展開後のカーソルが移動します。
          <code>$1</code>の位置を修正後、<kbd>Tab</kbd>キーを押せば次の数字のタブストップに移動します。<br>
          <code>$0</code>は特別なタブストップで一番最後に移動する場所です。
        </p>
        <p>タブストップは同じ数字を複数記載してもかまいません。
          複数記載した場合、カーソルが移動した時にマルチカーソルとして複数選択された状態になります。</p>
      </section>
      <section id="placeholder">
        <h3>3-2. プレースホルダー</h3>
        <p>プレースホルダーはタブストップにデフォルトの文字列を入力しておく機能です。
          構文は<code>${N: "デフォルトの文字列"}</code>のようになり、<code>N</code>にタブストップのインデックス、<code>"デフォルトの文字列"</code>に文字列を入力します。
          <b>図2-5</b>でも<code>"&lt;html lang=\"${1:ja}\"&gt;",</code>で使われています。
        </p>
      </section>
      <section id="choice">
        <h3>3-3. チョイス</h3>
        <p>チョイスを使用した場合、候補の中から選ぶことが可能です。
          構文は<code>${N|選択肢1,選択肢2,...選択肢N|}</code>のように記載します。
        </p>
        <figure>
          <pre><code class="json">"variable": {
  "prefix": "var",
  "scope": "javascript",
  "body": "${1|const,let|} ${2:var} = ${0: element};"
}</code></pre>
          <img src="img/choice.png" alt="choice" width="162px" height="64px">
          <figcaption><span class="figure">図2-6</span> チョイスの例</figcaption>
        </figure>
      </section>
      <section id="variable">
        <h3>3-4. 変数</h3>
        <p>現在の時刻やファイル名など時と場所で変わるものは変数で定義されています。</p>
        <p>変数の構文<code>$変数名</code>もしくは<code>${変数名:デフォルト文字列}</code>のように記載します。<br>
          二つ目の構文は変数が設定されていない場合デフォルト文字列が挿入されます。<br>
          変数が定義されていない場合変数名が挿入され、プレースホルダーに変換されます。
        </p>
        <p>現在定義されている変数の一覧を記載します。</p>
        <ul class="variable-list">
          <li><code>TM_SELECTED_TEXT</code><span>現在選択されているテキスト</span></li>
          <li><code>TM_CURRENT_LINE</code><span>現在の行の内容</span></li>
          <li><code>TM_CURRENT_WORD</code><span>カーソルの下の単語の内容</span></li>
          <li><code>TM_LINE_INDEX</code><span>0から始まる行番号</span></li>
          <li><code>TM_LINE_NUMBER</code><span>1から始まる行番号</span></li>
          <li><code>TM_FILENAME</code><span>現在のドキュメントのファイル名</span></li>
          <li><code>TM_FILENAME_BASE</code><span>現在のドキュメントの拡張子を除いたファイル名</span></li>
          <li><code>TM_DIRECTORY</code><span>現在のドキュメントのディレクトリ</span></li>
          <li><code>TM_FILEPATH</code><span>現在のドキュメントの完全なファイルパス</span></li>
          <li><code>RELATIVE_FILEPATH</code><span>現在のドキュメントのVSCodeで現在開いているトップフォルダもしくはワークスペースに対する相対パス</span></li>
          <li><code>CLIPBOARD</code><span>クリップボードの内容</span></li>
          <li><code>WORKSPACE_NAME</code><span>開いているワークスペースまたはフォルダーの名前</span></li>
          <li><code>WORKSPACE_FOLDER</code><span>開いているワークスペースまたはフォルダーのパス</span></li>
          <li><code>CURSOR_INDEX</code><span>マルチカーソルにおける0から始まるカーソル番号</span></li>
          <li><code>CURSOR_NUMBER</code><span>マルチカーソルにおける1から始まるカーソル番号</span></li>
          <li><code>CURRENT_YEAR</code><span>今年の4桁の数字(例: 2023)</span></li>
          <li><code>CURRENT_YEAR_SHORT</code><span>今年の霜2桁の数字(例: 23)</span></li>
          <li><code>CURRENT_MONTH</code><span>今月の完全な名前(例: July)</span></li>
          <li><code>CURRENT_MONTH_NAME</code><span>今月の短縮名(例: Jul)</span></li>
          <li><code>CURRENT_MONTH_NAME_SHORT</code><span>今月の2桁の数字(例: 08)</span></li>
          <li><code>CURRENT_DATE</code><span>今日の日付の2桁の数字(例: 31)</span></li>
          <li><code>CURRENT_DAY_NAME</code><span>曜日の名前(例: Monday)</span></li>
          <li><code>CURRENT_DAY_NAME_SHORT</code><span>曜日の短縮名(例: Mon)</span></li>
          <li><code>CURRENT_HOUR</code><span>24時間形式の現在の時刻</span></li>
          <li><code>CURRENT_MINUTE</code><span>現在の分を2桁で表示します。</span></li>
          <li><code>CURRENT_SECOND</code><span>現在の秒を2桁で表示します。</span></li>
          <li><code>CURRENT_SECONDS_UNIX</code><span>Unixエポックからの秒数</span></li>
          <li>
            <code>CURRENT_TIMEZONE_OFFSET</code><span>現在のUTCタイムゾーンオフセット(<code>+HH:MM</code>もしくは<code>-HH:MM</code>)</span>
          </li>
          <li><code>RANDOM</code><span>6桁の10進数のランダムな値(例: 123456)</span></li>
          <li><code>RANDOM_HEX</code><span>6桁の16進数のランダムな値(例: F5E4CC)</span></li>
          <li><code>UUID</code><span>バージョン4 UUID</span></li>
          <li><code>BLOCK_COMMENT_START</code><span>HTMLの場合<code>&lt;!--</code>, CSSの場合<code>/*</code></span></li>
          <li><code>BLOCK_COMMENT_END</code><span>HTMLの場合<code>--&gt;</code>, CSSの場合<code>*/</code></span></li>
          <li><code>LINE_COMMENT</code><span>javascriptの場合<code>//</code></span></li>
        </ul>
      </section>
      <section id="regex">
        <h3>3-5. 正規表現</h3>
        <p>変数に対して正規表現で変換することが可能です。またプレースホルダーも変数の対象です。</p>
        <p>その場合の構文は<code>${変数/正規表現/置換後のテキスト/正規表現オプション}</code>となります。</p>
        <p>正規表現の置換に関してはJavascriptの正規表現を参照願います。</p>
        <p>置換後のテキストで通常<code>$1</code>と書く部分に対して、独自機能として大文字化などのオプションがあります。</p>
        <section>
          <h4>3-5-1. 変換の例</h4>
          <table>
            <caption>ファイル名「<code>example-123.456-TEST.js</code>」に対して正規表現を使用したサンプルです。</caption>
            <thead>
              <tr>
                <th>例</th>
                <th>出力</th>
                <th>説明</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>"${TM_FILENAME/[\\.]/_/}"</code></td>
                <td><code>example-123_456-TEST.js</code></td>
                <td>最初に出現した<code>.</code>を<code>_</code>に変換します</td>
              </tr>
              <tr>
                <td><code>"${TM_FILENAME/[\\.]/_/g}"</code></td>
                <td><code>example-123_456-TEST_js</code></td>
                <td>出現した<code>.</code>を全て<code>_</code>に変換します</td>
              </tr>
              <tr>
                <td><code>"${TM_FILENAME/(.*)/${1:/upcase}/}"</code></td>
                <td><code>EXAMPLE-123.456-TEST.JS</code></td>
                <td>全て大文字に変換します</td>
              </tr>
              <tr>
                <td><code>"${TM_FILENAME/[^0-9^a-z]//gi}"</code></td>
                <td><code>example123456TESTjs</code></td>
                <td>英数字以外の文字を削除する。</td>
              </tr>
            </tbody>
          </table>
        </section>

      </section>
      <section id="syntax">
        <h3>3-6. 文法</h3>
        <figure>
          <pre><code class="EBNF">any ::= tabstop | placeholder | choice | variable | text
tabstop ::= '$' int
| '${' int '}'
| '${' int transform '}'
placeholder ::= '${' int ':' any '}'
choice ::= '${' int '|' text (',' text)* '|}'
variable ::= '$' var | '${' var '}'
| '${' var ':' any '}'
| '${' var transform '}'
transform ::= '/' regex '/' (format | text)+ '/' options
format ::= '$' int | '${' int '}'
| '${' int ':' '/upcase' | '/downcase' | '/capitalize' | '/camelcase' | '/pascalcase' '}'
| '${' int ':+' if '}'
| '${' int ':?' if ':' else '}'
| '${' int ':-' else '}' | '${' int ':' else '}'
regex ::= JavaScript Regular Expression value (ctor-string)
options ::= JavaScript Regular Expression option (ctor-options)
var ::= [_a-zA-Z] [_a-zA-Z0-9]*
int ::= [0-9]+
text ::= .*
if ::= text
else ::= text</code></pre>
          <figcaption><span class="figure">図3-1</span> EBNF記法</figcaption>
        </figure>
      </section>
    </section>
  </article>
</body>


</html>